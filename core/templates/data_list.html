{% extends "base.html" %}
{% block content %}
<h2>Data List</h2>

<form method="get" class="inline" style="margin:8px 0 12px">
  Date: <input type="date" name="search_date" value="{{ search_date }}">
  Order:
  <select name="order_by">
    <option value="-date"    {% if order_by == "-date" %}selected{% endif %}>Date ↓</option>
    <option value="date"     {% if order_by == "date" %}selected{% endif %}>Date ↑</option>
    <option value="-weight"  {% if order_by == "-weight" %}selected{% endif %}>Weight ↓</option>
    <option value="weight"   {% if order_by == "weight" %}selected{% endif %}>Weight ↑</option>
    <option value="-steps"   {% if order_by == "-steps" %}selected{% endif %}>Steps ↓</option>
    <option value="steps"    {% if order_by == "steps" %}selected{% endif %}>Steps ↑</option>
    <option value="-calories"{% if order_by == "-calories" %}selected{% endif %}>Calories ↓</option>
    <option value="calories" {% if order_by == "calories" %}selected{% endif %}>Calories ↑</option>
  </select>
  <button type="submit">Apply</button>
  <a href="{% url 'data_list' %}">Reset</a>
</form>

{% if page_obj %}
  <table>
    <thead>
      <tr><th>Date</th><th>Weight (kg)</th><th>Steps</th><th>Calories</th><th>Action</th></tr>
    </thead>
    <tbody>
      {% for m in page_obj.object_list %}
      <tr>
        <td>{{ m.date }}</td>
        <td>{{ m.weight }}</td>
        <td>{{ m.steps|default_if_none:"" }}</td>
        <td>{{ m.calories|default_if_none:"" }}</td>
        <td>
          <a href="{% url 'data_detail' m.pk %}">Detail</a>
          <span style="margin:0 6px;">|</span>
          <!-- Delete uses POST + CSRF; confirm dialog to avoid mistakes -->
          <form method="post"
                action="{% url 'data_delete' m.pk %}"
                style="display:inline"
                onsubmit="return confirm('Delete this record?');">
            {% csrf_token %}
            <!-- Send current list URL back so we can return to the same page/filters after deletion -->
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button type="submit"
                    style="border:none;background:none;color:#0366d6;cursor:pointer;padding:0;">
              Delete
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div style="margin-top:10px">
    {% if page_obj.has_previous %}
      <a href="?page=1&order_by={{ order_by }}&search_date={{ search_date }}">First</a>
      <a href="?page={{ page_obj.previous_page_number }}&order_by={{ order_by }}&search_date={{ search_date }}">Prev</a>
    {% endif %}
    <span>Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&order_by={{ order_by }}&search_date={{ search_date }}">Next</a>
      <a href="?page={{ page_obj.paginator.num_pages }}&order_by={{ order_by }}&search_date={{ search_date }}">Last</a>
    {% endif %}
  </div>
{% else %}
  <div class="msgs ok">No records yet. <a href="{% url 'add_metric' %}">Add the first one</a>.</div>
{% endif %}
{% endblock %}
